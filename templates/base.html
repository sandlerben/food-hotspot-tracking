<!doctype html>
<html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" href="static/css/main.css">
	<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=visualization,places"></script>

	<script>
		var map, pointarray, heatmap, tweetGeoData;

		 tweetGeoData = [
			{% for i in geodata %}
                new google.maps.LatLng({{ i[0] }}, {{ i[1] }}),
			{% endfor %}
        ];

		var pointArray = new google.maps.MVCArray(tweetGeoData);

		
		function initialize() {

			
			var mapOptions = {
				zoom: 6,
				center: new google.maps.LatLng(1, 38), // middle of Kenya
				mapTypeId: google.maps.MapTypeId.MAP
			};
			
			map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);


			service = new google.maps.places.PlacesService(map);
						
			{% for loc in user_locs %}
			
			var request = {
				query: '{{ loc }}',
			};
     					 
			service.textSearch(request, callback);
			 
			{% endfor %}


			heatmap = new google.maps.visualization.HeatmapLayer({
				data: pointArray
			});

			heatmap.setMap(map);
		}

		function callback(results, status) {
			if (status == google.maps.places.PlacesServiceStatus.OK) {
				var place = results[0];

				if (typeof(place) !== 'undefined') {
					var loc = place.geometry.location;
					console.log('pushing ' + loc.toString() + ' to geoData');
					pointArray.push(loc); 
				}	
				
			}
		}

		google.maps.event.addDomListener(window, 'load', initialize);
	</script>
</head>

<body>
	{% include 'header.html' %}
	<div id="map-wrapper">
		<div id="map-canvas"></div>
	</div>
	<main>
		<h1>Recent tweets in the area</h1>
		{% include 'tweets.html' %}
	</main>
	<footer>
		<div class="wrapper">
			Built at Hack the Change 2014 by Max McCarthy, Yoni Nachmany, and Ben Sandler.
		</div>
	</footer>
</body>

</html>